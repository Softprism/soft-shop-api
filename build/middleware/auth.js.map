{"version":3,"sources":["../../src/middleware/auth.js"],"names":["auth","req","res","next","token","headers","authorization","startsWith","split","decoded","jwt","verify","process","env","JWT_SECRET","user","store","admin","err","console","error","status","json","success","msg"],"mappings":";;;;;;;;;AAAA;;AAEA,IAAMA,IAAI,GAAG,SAAPA,IAAO,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChC,MAAIC,KAAJ;;AAEA,MACCH,GAAG,CAACI,OAAJ,CAAYC,aAAZ,IACAL,GAAG,CAACI,OAAJ,CAAYC,aAAZ,CAA0BC,UAA1B,CAAqC,QAArC,CAFD,EAGE;AACD,QAAI;AACHH,MAAAA,KAAK,GAAGH,GAAG,CAACI,OAAJ,CAAYC,aAAZ,CAA0BE,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAAR;;AAEA,UAAMC,OAAO,GAAGC,yBAAIC,MAAJ,CAAWP,KAAX,EAAkBQ,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,UAAIL,OAAO,CAACM,IAAZ,EAAkB;AACjBd,QAAAA,GAAG,CAACc,IAAJ,GAAWN,OAAO,CAACM,IAAnB;AACA;;AAED,UAAIN,OAAO,CAACO,KAAZ,EAAmB;AAClBf,QAAAA,GAAG,CAACe,KAAJ,GAAYP,OAAO,CAACO,KAApB;AACA;;AAED,UAAIP,OAAO,CAACQ,KAAZ,EAAmB;AAClBhB,QAAAA,GAAG,CAACgB,KAAJ,GAAYR,OAAO,CAACQ,KAApB;AACA;;AAEDd,MAAAA,IAAI;AACJ,KAlBD,CAkBE,OAAOe,GAAP,EAAY;AACbC,MAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACAhB,MAAAA,GAAG,CACDmB,MADF,CACS,GADT,EAEEC,IAFF,CAEO;AAAEC,QAAAA,OAAO,EAAE,KAAX;AAAkBC,QAAAA,GAAG,EAAE;AAAvB,OAFP;AAGA;AACD;;AAED,MAAI,CAACpB,KAAL,EAAY;AACXF,IAAAA,GAAG,CAACmB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE,KAAX;AAAkBC,MAAAA,GAAG,EAAE;AAAvB,KAArB;AACA;AACD,CApCD","sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst auth = (req, res, next) => {\r\n\tlet token;\r\n\r\n\tif (\r\n\t\treq.headers.authorization &&\r\n\t\treq.headers.authorization.startsWith('Bearer')\r\n\t) {\r\n\t\ttry {\r\n\t\t\ttoken = req.headers.authorization.split(' ')[1];\r\n\r\n\t\t\tconst decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n\r\n\t\t\tif (decoded.user) {\r\n\t\t\t\treq.user = decoded.user;\r\n\t\t\t}\r\n\r\n\t\t\tif (decoded.store) {\r\n\t\t\t\treq.store = decoded.store;\r\n\t\t\t}\r\n\r\n\t\t\tif (decoded.admin) {\r\n\t\t\t\treq.admin = decoded.admin;\r\n\t\t\t}\r\n\r\n\t\t\tnext();\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tres\r\n\t\t\t\t.status(401)\r\n\t\t\t\t.json({ success: false, msg: 'Not authorized, token failed' });\r\n\t\t}\r\n\t}\r\n\r\n\tif (!token) {\r\n\t\tres.status(401).json({ success: false, msg: 'Not authorized, no token' });\r\n\t}\r\n};\r\n\r\nexport { auth };\r\n"],"file":"auth.js"}